(function(e){function t(t){for(var o,r,a=t[0],s=t[1],u=t[2],c=0,l=[];c<a.length;c++)r=a[c],Object.prototype.hasOwnProperty.call(d,r)&&d[r]&&l.push(d[r][0]),d[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);h&&h(t);while(l.length)l.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,r=1;r<n.length;r++){var a=n[r];0!==d[a]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},d={app:0},i=[];function a(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-494a584a":"aa479d82","chunk-4f78d04e":"d0fffda1","chunk-f013bbdc":"77f7d746","chunk-f3efae02":"9f9b67e6","chunk-f5c8fa2c":"10ce1bf9","chunk-fe54653a":"eb9822ad"}[e]+".js"}function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-494a584a":1,"chunk-4f78d04e":1,"chunk-f013bbdc":1,"chunk-f3efae02":1,"chunk-f5c8fa2c":1,"chunk-fe54653a":1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-494a584a":"1fcec379","chunk-4f78d04e":"0549f72d","chunk-f013bbdc":"7f5c22c2","chunk-f3efae02":"006900d8","chunk-f5c8fa2c":"a1ce41ef","chunk-fe54653a":"d54e404b"}[e]+".css",d=s.p+o,i=document.getElementsByTagName("link"),a=0;a<i.length;a++){var u=i[a],c=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(c===o||c===d))return t()}var l=document.getElementsByTagName("style");for(a=0;a<l.length;a++){u=l[a],c=u.getAttribute("data-href");if(c===o||c===d)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var o=t&&t.target&&t.target.src||d,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete r[e],h.parentNode.removeChild(h),n(i)},h.href=d;var p=document.getElementsByTagName("head")[0];p.appendChild(h)})).then((function(){r[e]=0})));var o=d[e];if(0!==o)if(o)t.push(o[2]);else{var i=new Promise((function(t,n){o=d[e]=[t,n]}));t.push(o[2]=i);var u,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=a(e);var l=new Error;u=function(t){c.onerror=c.onload=null,clearTimeout(h);var n=d[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",l.name="ChunkLoadError",l.type=o,l.request=r,n[1](l)}d[e]=void 0}};var h=setTimeout((function(){u({type:"timeout",target:c})}),12e4);c.onerror=c.onload=u,document.head.appendChild(c)}return Promise.all(t)},s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=t,u=u.slice();for(var l=0;l<u.length;l++)t(u[l]);var h=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{"font-size":"14px"}},[e._v(" 布局： "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.settings.ranker,expression:"settings.ranker"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.settings,"ranker",t.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"network-simplex"}},[e._v(" network-simplex ")]),n("option",{attrs:{value:"tight-tree"}},[e._v(" tight-tree ")]),n("option",{attrs:{value:"longest-path"}},[e._v(" longest-path ")])]),e._v(" 连接样式 "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.settings.connector[0],expression:"settings.connector[0]"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.settings.connector,0,t.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"Bezier"}},[e._v("贝塞尔曲线")]),n("option",{attrs:{value:"Flowchart"}},[e._v(" 90度流程线 ")]),n("option",{attrs:{value:"StateMachine"}},[e._v(" 状态机 ")]),n("option",{attrs:{value:"Straight"}},[e._v(" 直线 ")])]),e._v(" stub: "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.settings.connector[1].stub,expression:"settings.connector[1].stub"}],attrs:{type:"text"},domProps:{value:e.settings.connector[1].stub},on:{input:function(t){t.target.composing||e.$set(e.settings.connector[1],"stub",t.target.value)}}})]),n("div",{staticStyle:{overflow:"auto",width:"100%"},attrs:{id:"app"}},[n("flow-char",{key:e.task.ver,attrs:{node:e.task,settings:e.settings,"selected-id":e.editNode?e.editNode.id:void 0},on:{"task-action":e.onAction}})],1),n("div",{staticClass:"el-divider el-divider--horizontal"}),e.editNode?n("div",{staticClass:"form"},[n("div",{staticClass:"form-item"},[n("label",[e._v(" 名称")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editNode.name,expression:"editNode.name"}],attrs:{type:"text"},domProps:{value:e.editNode.name},on:{input:function(t){t.target.composing||e.$set(e.editNode,"name",t.target.value)}}})]),n("div",{staticClass:"form-item"},[n("label",[e._v("类型")]),n("select",{directives:[{name:"model",rawName:"v-model",value:e.editNode.nodeType,expression:"editNode.nodeType"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.editNode,"nodeType",t.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"node"}},[e._v("子任务")]),n("option",{attrs:{value:"parent"}},[e._v("父任务")])])])]):e._e()])},d=[],i=(n("4de4"),n("4160"),n("159b"),n("2909")),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("flow-char-node",{style:{width:"100%",height:e.node.height+"px",position:"relative"},attrs:{id:"node_char_root","selected-id":e.selectedId,node:e.node},on:{"task-action":e.onTaskAdd}})],1)},s=[],u=(n("99af"),n("7db0"),n("fb6a"),n("b0c0"),n("18a5"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.comp,{tag:"component",class:["node-window",e.node.nodeType.replace(":"," ")],style:e.nodeStyle,attrs:{node:e.node,id:"node_"+e.node.id,"selected-id":e.selectedId},on:{"task-action":e.onAddTask}},[e._t("default",[e._l(e.node.subNodes,(function(t){return n("flow-char-node",{key:t.id+"_"+t.ver+"_"+t.nodeType,attrs:{"selected-id":e.selectedId,node:t},on:{"task-action":e.onAddTask}})})),e._l(e.node.subEdges,(function(t,o){return[e._l(t.points,(function(e,r){return[n("div",{key:o+"_"+r+"_"+t.points,style:{position:"absolute",top:e.y-2+"px",left:e.x-2+"px",width:"5px",height:"5px",background:"red"}})]}))]}))])],2)}),c=[],l=(n("d3b7"),n("ac1f"),n("5319"),{name:"flow-char-node",props:["node","selectedId"],computed:{nodeStyle:function(){return{left:this.node.x-this.node.width/2+"px",top:this.node.y-this.node.height/2+"px",height:this.node.height+"px",width:this.node.width+"px",position:"absolute"}},comp:function(){var e=this;return function(){return n("c51a")("./".concat(e.node.nodeType.replace(":","/"),".vue"))}}},methods:{onAddTask:function(){return this.$emit.apply(this,["task-action"].concat(Array.prototype.slice.call(arguments)))}}}),h=l,p=n("2877"),f=Object(p["a"])(h,u,c,!1,null,null,null),g=f.exports,v=n("e34f"),b=n.n(v),m=n("e193"),y={name:"flow-char",components:{FlowCharNode:g},props:["node","selectedId","settings"],data:function(){return{jp:void 0}},created:function(){this.layout(this.node)},methods:{empty2array:function(e){return e||[]},anchor:function(e,t,n){return this.nearly(e.y-.5*e.height,n)?"TopCenter":this.nearly(e.y+.5*e.height,n)?"BottomCenter":this.nearly(e.x+.5*e.width,t)?"Right":this.nearly(e.x-.5*e.width,t)?"Left":"Right"},nearly:function(e,t){var n=e-t;return n<1&&n>-1},layout:function(e){var t=this;if(console.log(111),e.subNodes&&0!==e.subNodes.length){var n=new b.a.graphlib.Graph({directed:!0});n.setGraph({rankdir:"LR",nodesep:16,ranksep:30,rangker:this.settings.ranker,marginx:20,marginy:20}),n.setDefaultEdgeLabel((function(){return{}})),this.empty2array(e.subNodes).forEach((function(e){t.layout(e),n.setNode(e.id,{label:e.name,width:e.width,height:e.height,data:e})})),this.empty2array(e.subEdges).forEach((function(e){n.setEdge(e.nodeId,e.nextNodeId,e)})),b.a.layout(n),n.nodes().forEach((function(e){var t=n.node(e),o=t.data;Object.assign(o,{width:t.width,height:t.height,x:t.x,y:t.y})})),n.edges(),e.height=n.graph().height,e.width=n.graph().width}},connect:function(e){var t=this;this.empty2array(e.subEdges).forEach((function(n){if(!n.points||0===n.points.length)throw Error(JSON.stringify(n)+"has no points");var o,r,d=e.subNodes.find((function(e){return e.id===n.nodeId})),i=n.points[0];o="circle"===d.shape?t.jp.addEndpoint("node_"+n.nodeId,{anchor:[t.anchor(d,i.x,i.y)]}):t.jp.addEndpoint("node_"+n.nodeId,{anchor:[0,0,0,0,i.x-(d.x-d.width/2),i.y-(d.y-d.height/2)]}),i=n.points[n.points.length-1],d=e.subNodes.find((function(e){return e.id===n.nextNodeId})),r="circle"===d.shape?t.jp.addEndpoint("node_"+n.nextNodeId,{anchor:[t.anchor(d,i.x,i.y)]}):t.jp.addEndpoint("node_"+n.nextNodeId,{anchor:[0,0,0,0,i.x-(d.x-d.width/2),i.y-(d.y-d.height/2)]}),t.jp.connect({source:o,target:r,overlays:[["Arrow",{width:9,length:9,location:1}],["Label",{label:""}]]})})),this.empty2array(e.subNodes).forEach((function(e){t.connect(e)}))},allMounted:function(e,t,n){var o="node_"+t.id,r=n[o]||e.querySelector("#"+o);if(!r)return!1;n[o]=!0;for(var d=0,i=t.subNodes.length;d<i;d++){var a=t.subNodes[d],s=this.allMounted(e,a,n);if(!s)return!1}return!0},onTaskAdd:function(){this.$emit.apply(this,["task-action"].concat(Array.prototype.slice.call(arguments)))}},mounted:function(){var e=this;m["jsPlumb"].ready((function(){e.jp=m["jsPlumb"].getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},EndpointStyle:{radius:.11},PaintStyle:{strokeWidth:2,stroke:"#ffa500"},EndpointHoverStyle:{fill:"#ffa500"},Connector:e.settings.connector,Container:"node_char_root"});var t={},n=function n(){e.allMounted(e.$el,e.node,t)?e.connect(e.node):setTimeout(n,100)};e.$nextTick((function(){n()}))}))}},N=y,x=Object(p["a"])(N,a,s,!1,null,"0ca12ad7",null),k=x.exports,w={name:"App",components:{FlowChar:k},data:function(){return{editNode:void 0,settings:{ranker:"network-simplex",connector:["Flowchart",{stub:10}]},task:{id:"char_root",name:"root",nodeType:"root",ver:1,subNodes:[],subEdges:[]}}},watch:{settings:{handler:function(){this.refresh()},immediate:!0,deep:!0}},methods:{onAction:function(e,t,n){"add"===e?this.editNode=this.onAddTask(t,n):"del"===e?(this.edgeMode&&this.edgeMode.id===t.id&&(this.editNode=void 0),this.delTask(t)):"edit"===e&&(this.editNode=t),this.refresh()},delTask:function(e){var t=this,n=e.parent.subEdges.filter((function(t){return t.nodeId===e.id})),o=e.parent.subEdges.filter((function(t){return t.nextNodeId===e.id})),r=[];o.forEach((function(t){var n=e.parent.subNodes.filter((function(e){return e.id===t.nodeId&&"connector"===e.nodeType}));r.push.apply(r,Object(i["a"])(n))})),n.forEach((function(t){var n=e.parent.subNodes.filter((function(e){return e.id===t.nextNodeId&&"connector"===e.nodeType}));r.push.apply(r,Object(i["a"])(n))})),n.length>1&&o.length>1?(e.nodeType="connector",e.shap="circle",e.width=20,e.height=20):(e.parent.subNodes=e.parent.subNodes.filter((function(t){return t.id!==e.id})),e.parent.subEdges=e.parent.subEdges.filter((function(t){return t.nodeId!==e.id&&t.nextNodeId!==e.id})),1===n.length?o.forEach((function(o){o.nextNodeId=n[0].nextNodeId,t.isConnected(e.parent.subEdges,o.nodeId,o.nextNodeId)||e.parent.subEdges.push(o)})):1===o.length&&n.forEach((function(n){n.nodeId=o[0].nodeId,t.isConnected(e.parent.subEdges,n.nodeId,n.nextNodeId)||e.parent.subEdges.push(n)})),r.forEach((function(e){t.delTask(e)})))},isConnected:function(e,t,n){for(var o=e.filter((function(e){return e.nodeId===t})),r=0,d=o.length;r<d;r++){var i=o[r];if(i.nextNodeId===n)return!0;var a=this.isConnected(e,i.nextNodeId,n);if(a)return!0}return!1},refresh:function(){this.task.ver=this.task.ver+1},onAddTask:function(e,t){var n={id:(new Date).getTime(),name:"为命名",subNodes:[],subEdges:[],parent:e.parent,nodeType:"node",width:100,height:30,ver:1};if("connector"===e.nodeType)e.nodeType="node",e.shape=void 0,e.width=100,e.height=30;else if("sub"===t){n.parent=e,n.nodeType="start",n.width=80,e.subNodes.push(n);var o={id:"end-"+(new Date).getTime(),name:"end",subNodes:[],subEdges:[],parent:e,shape:"circle",nodeType:"end",width:34,height:34,ver:1};e.subNodes.push(o),e.subEdges.push({nodeId:n.id,nextNodeId:o.id})}else"right"===t?this.addRight(e,n):"left"===t?this.addLeft(e,n):this.addUpDown(e,n);return n},addRight:function(e,t){e.parent.subNodes.push(t);var n=e.parent.subEdges.filter((function(t){return t.nodeId===e.id}));n.forEach((function(e){e.nodeId=t.id})),e.parent.subEdges.push({nodeId:e.id,nextNodeId:t.id})},addLeft:function(e,t){e.parent.subNodes.push(t);var n=e.parent.subEdges.filter((function(t){return t.nextNodeId===e.id}));n.forEach((function(e){e.nextNodeId=t.id})),e.parent.subEdges.push({nodeId:t.id,nextNodeId:e.id})},addUpDown:function(e,t){e.parent.subNodes.unshift(t);var n=e.parent.subEdges.filter((function(t){return t.nextNodeId===e.id})),o=e.parent.subEdges.filter((function(t){return t.nodeId===e.id}));if(1===n.length)e.parent.subEdges.push({nodeId:n[0].nodeId,nextNodeId:t.id});else if(n.length>1){var r={id:"conn_pre_"+(new Date).getTime(),name:"连接点_"+e.parent.subNodes.length,nodeType:"connector",subNodes:[],subEdges:[],parent:e.parent,width:20,height:20,shape:"circle",ver:1};n.forEach((function(e){e.nextNodeId=r.id})),e.parent.subNodes.unshift(r),e.parent.subEdges.push({nodeId:r.id,nextNodeId:t.id}),e.parent.subEdges.push({nodeId:r.id,nextNodeId:e.id})}if(1===o.length)e.parent.subEdges.push({nodeId:t.id,nextNodeId:o[0].nextNodeId});else if(o.length>1){var d={id:"conn_next_"+(new Date).getTime(),name:"连接点_"+e.parent.subNodes.length,nodeType:"connector",subNodes:[],subEdges:[],parent:e.parent,width:20,height:20,shape:"circle",ver:1};e.parent.subNodes.unshift(d),o.forEach((function(e){e.nodeId=d.id})),e.parent.subEdges.push({nodeId:t.id,nextNodeId:d.id}),e.parent.subEdges.push({nodeId:e.id,nextNodeId:d.id})}}}},E=w,_=(n("034f"),Object(p["a"])(E,r,d,!1,null,null,null)),I=_.exports;o["a"].config.productionTip=!1,new o["a"]({render:function(e){return e(I)}}).$mount("#app")},"85ec":function(e,t,n){},c51a:function(e,t,n){var o={"./connector.vue":["2cca","chunk-f3efae02"],"./end.vue":["5659","chunk-4f78d04e"],"./node.vue":["0519","chunk-494a584a"],"./parent.vue":["a804","chunk-f5c8fa2c"],"./root.vue":["4fd9","chunk-f013bbdc"],"./start.vue":["f9d5","chunk-fe54653a"]};function r(e){if(!n.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(o)},r.id="c51a",e.exports=r}});
//# sourceMappingURL=app.aa265564.js.map